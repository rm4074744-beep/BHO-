<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MingleJoys - AI Image</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
body{margin:0;font-family:Arial;background:#f2f2f2;}
.top-bar{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background:white;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.back-btn{cursor:pointer;font-size:28px;}
.page-title{font-weight:bold;font-size:20px;}
.prompt-box{width:90%;max-width:500px;margin:20px auto;}
.prompt-box textarea{width:100%;height:80px;padding:10px;border-radius:10px;border:1px solid #ccc;resize:none;font-size:14px;}
.preview-container{width:100%;max-width:500px;margin:20px auto;border-radius:12px;min-height:300px;display:flex;justify-content:center;align-items:center;background:white;position:relative;}
.preview-container img{max-width:100%;max-height:100%;border-radius:12px;}
.tools{position:fixed;top:100px;right:10px;display:flex;flex-direction:column;gap:15px;}
.tools span{cursor:pointer;font-size:28px;color:#1877f2;}
.bottom-buttons{width:90%;max-width:500px;margin:20px auto;display:flex;justify-content:space-between;}
.bottom-buttons button{flex:1;margin:0 5px;padding:12px;border:none;border-radius:8px;font-size:16px;cursor:pointer;}
#saveBtn{background:#0b3d91;color:white;}
#shareBtn{background:#1877f2;color:white;}
</style>
</head>
<body>

<div class="top-bar">
  <span class="material-icons back-btn" onclick="window.history.back()">arrow_back</span>
  <span class="page-title">Create AI Image</span>
  <span></span>
</div>

<div class="prompt-box">
  <textarea id="promptInput" placeholder="Describe your image..."></textarea>
  <button onclick="generateImage()">Generate</button>
</div>

<div class="preview-container" id="previewContainer">
  <span id="previewText">Your AI generated image will appear here</span>
  <img id="previewImage" src="" style="display:none;">
</div>

<div class="tools">
  <span class="material-icons" title="Sticker">emoji_emotions</span>
  <span class="material-icons" title="Tag">label</span>
  <span class="material-icons" title="Effect">auto_awesome</span>
  <span class="material-icons" title="Sound">music_note</span>
</div>

<div class="bottom-buttons">
  <button id="saveBtn">Save</button>
  <button id="shareBtn">Share Now</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyA1h3IIRC9la-kXyYnVEfwxzzoyBIL70Js",
  authDomain: "my-website-a0545.firebaseapp.com",
  databaseURL: "https://my-website-a0545-default-rtdb.firebaseio.com",
  projectId: "my-website-a0545",
  storageBucket: "my-website-a0545.firebasestorage.app",
  messagingSenderId: "103602694974",
  appId: "1:103602694974:web:12f890844e6ad6a513da6f",
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Supabase Config
const supabase = createClient(
    "https://jzagzyagwlvfsptovslq.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp6YWd6eWFnd2x2ZnNwdG92c2xxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNzcwMTQsImV4cCI6MjA4Njc1MzAxNH0.PheZD_DF11ATHW3jwsxsrBgywtir1YkGUAslSis2Kfo"
);

const previewImage = document.getElementById('previewImage');
const previewText = document.getElementById('previewText');

async function generateImage(){
  const prompt = document.getElementById('promptInput').value.trim();
  if(!prompt) return alert("Write a prompt first!");

  previewText.innerText = "Generating image...";
  previewImage.style.display="none";

  const res = await fetch("http://localhost:3000/generate-image",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({prompt})
  });
  const data = await res.json();
  previewImage.src = data.imageUrl;
  previewImage.style.display="block";
  previewText.style.display="none";
}

// Save
document.getElementById('saveBtn').addEventListener('click',()=>{
  if(!previewImage.src) return alert("Generate first!");
  const a = document.createElement('a');
  a.href = previewImage.src;
  a.download = "minglejoys_ai.png";
  a.click();
});

// Share Now â†’ Story/Post
document.getElementById('shareBtn').addEventListener('click',async ()=>{
  if(!previewImage.src) return alert("Generate first!");

  const choice = prompt("Type 'story' to share as Story, 'post' to share as Post").toLowerCase();
  if(choice==='story'){
    // Upload to Supabase
    await supabase.from("stories").insert([{ image_url: previewImage.src, user_name: "YourName", created_at: new Date().toISOString() }]);
    alert("Story shared!");
  }else if(choice==='post'){
    // Upload to Firebase
    push(ref(db,"posts"),{
      profilePic:"https://via.placeholder.com/40",
      userName:"YourName",
      caption:document.getElementById('promptInput').value,
      image: previewImage.src
    });
    alert("Post shared!");
  }else{
    alert("Canceled");
  }
});
</script>

</body>
</html>
