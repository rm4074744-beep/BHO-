<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MingleJoys - Upload Story</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#f2f2f2;
}

/* ===== TOP BAR ===== */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 15px;
  background:white;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.back-btn{
  cursor:pointer;
  font-size:28px;
}

.page-title{
  font-weight:bold;
  font-size:20px;
}

/* ===== IMAGE PREVIEW ===== */
.preview-container{
  width:100%;
  max-width:500px;
  margin:20px auto;
  border:2px dashed #ccc;
  border-radius:12px;
  height:400px;
  display:flex;
  justify-content:center;
  align-items:center;
  background:white;
  position:relative;
}

.preview-container img{
  max-width:100%;
  max-height:100%;
  border-radius:12px;
}

/* ===== RIGHT TOOLS ===== */
.tools{
  position:fixed;
  top:100px;
  right:10px;
  display:flex;
  flex-direction:column;
  gap:15px;
}

.tools span{
  cursor:pointer;
  font-size:28px;
  color:#1877f2;
}

/* ===== CREATE IMAGE ===== */
.create-image{
  position:fixed;
  top:300px;
  right:10px;
  font-size:32px;
  color:#ff6600;
  cursor:pointer;
}

/* ===== SETTINGS ===== */
.settings{
  position:fixed;
  top:370px;
  right:10px;
  font-size:28px;
  cursor:pointer;
}

/* ===== CAPTION ===== */
.caption-box{
  width:90%;
  max-width:500px;
  margin:20px auto;
}

.caption-box textarea{
  width:100%;
  height:60px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  resize:none;
  font-size:14px;
}

/* ===== SHARE NOW ===== */
.share-now{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#1877f2;
  color:white;
  padding:12px 25px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ===== TOP BAR ===== -->
<div class="top-bar">
  <span class="material-icons back-btn" onclick="window.history.back()">arrow_back</span>
  <span class="page-title">Upload Story</span>
  <span></span>
</div>

<!-- ===== IMAGE PREVIEW ===== -->
<div class="preview-container" id="previewContainer">
  <span>Click below to select an image</span>
  <img id="previewImage" src="" style="display:none;">
</div>

<input type="file" id="fileInput" accept="image/*" style="display:none">

<!-- ===== RIGHT TOOLS ===== -->
<div class="tools">
  <span class="material-icons" title="Sticker">emoji_emotions</span>
  <span class="material-icons" title="Tag">label</span>
  <span class="material-icons" title="Effect">auto_awesome</span>
  <span class="material-icons" title="Sound">music_note</span>
</div>

<!-- ===== CREATE IMAGE ===== -->
<span class="material-icons create-image" title="Create Image">image</span>

<!-- ===== SETTINGS ===== -->
<span class="material-icons settings" title="Story Privacy">settings</span>

<!-- ===== CAPTION ===== -->
<div class="caption-box">
  <textarea id="captionInput" placeholder="Add a caption..."></textarea>
</div>

<!-- ===== SHARE NOW ===== -->
<button class="share-now" id="shareBtn">Share Now</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyA1h3IIRC9la-kXyYnVEfwxzzoyBIL70Js",
  authDomain: "my-website-a0545.firebaseapp.com",
  databaseURL: "https://my-website-a0545-default-rtdb.firebaseio.com",
  projectId: "my-website-a0545",
  storageBucket: "my-website-a0545.appspot.com",
  messagingSenderId: "103602694974",
  appId: "1:103602694974:web:12f890844e6ad6a513da6f"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Variables
let uploadedFile = null;
let isPublic = true;

// Select image on click
document.getElementById('previewContainer').addEventListener('click', ()=>{
  document.getElementById('fileInput').click();
});

// Preview image
document.getElementById('fileInput').addEventListener('change', e=>{
  uploadedFile = e.target.files[0];
  if(uploadedFile){
    const reader = new FileReader();
    reader.onload = function(ev){
      const img = document.getElementById('previewImage');
      img.src = ev.target.result;
      img.style.display = "block";
    }
    reader.readAsDataURL(uploadedFile);
  }
});

// Toggle privacy
document.querySelector('.settings').addEventListener('click', ()=>{
  isPublic = !isPublic;
  alert("Story will be " + (isPublic ? "Public" : "Private"));
});

// Share Now
document.getElementById('shareBtn').addEventListener('click', async ()=>{
  if(!uploadedFile){
    alert("Please select an image!");
    return;
  }

  const formData = new FormData();
  formData.append("file", uploadedFile);
  formData.append("upload_preset", "dxksdswlu"); // Cloudinary preset

  // Upload to Cloudinary
  const cloudRes = await fetch("https://api.cloudinary.com/v1_1/YOUR_CLOUD_NAME/image/upload", {
    method:"POST",
    body: formData
  });
  const cloudData = await cloudRes.json();
  const imageUrl = cloudData.secure_url;

  // Get caption
  const caption = document.getElementById('captionInput').value;

  // Save to Firebase
  push(ref(db,"stories"),{
    image: imageUrl,
    caption: caption,
    userName: "Your Name",
    created_at: new Date().toISOString(),
    isPublic: isPublic
  });

  alert("Story uploaded successfully!");
  location.reload();
});
</script>

</body>
</html>
