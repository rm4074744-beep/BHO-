<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MingleJoys - Home</title>

<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f2f2f2;
}

/* ===== TOP BAR ===== */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 15px;
  background:white;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.logo{font-size:22px;font-weight:bold;}
.top-icons{display:flex;gap:15px;}
.top-icons span{cursor:pointer;font-size:26px;}

/* ===== STORY BAR ===== */
.story-bar{
  display:flex;
  gap:15px;
  overflow-x:auto;
  padding:12px 15px;
  background:white;
  border-bottom:1px solid #eee;
}

.story-box{
  width:85px;
  flex-shrink:0;
  text-align:center;
  cursor:pointer;
}

/* HEXAGON DESIGN */
.story-hex{
  position:relative;
  width:80px;
  height:90px;
  margin:auto;
}

.story-hex::before{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(45deg,#00f2ff,#6a5acd,#ff6ec7);
  clip-path: polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
}

.story-hex::after{
  content:"";
  position:absolute;
  inset:4px;
  background:white;
  clip-path: polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
}

.story-hex img{
  position:absolute;
  inset:8px;
  width:calc(100% - 16px);
  height:calc(100% - 16px);
  object-fit:cover;
  clip-path: polygon(50% 0%,100% 25%,100% 75%,50% 100%,0% 75%,0% 25%);
}

.story-hex.seen::before{
  background:grey;
}

.story-name{
  font-size:12px;
  margin-top:6px;
}

/* ===== STORY VIEWER ===== */
.story-viewer{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:black;
  display:none;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:5000;
}

.story-viewer img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.progress-bar{
  position:absolute;
  top:10px;
  left:10px;
  right:10px;
  height:4px;
  background:rgba(255,255,255,0.3);
}

.progress{
  height:100%;
  width:0%;
  background:white;
}

/* ===== CONTENT ===== */
.content{
  padding:20px;
  margin-bottom:100px;
}

.post{
  background:white;
  padding:10px;
  border-radius:12px;
  margin-bottom:15px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.post-header{
  display:flex;
  align-items:center;
  margin-bottom:8px;
}

.post-header img{
  width:40px;
  height:40px;
  border-radius:50%;
  margin-right:10px;
}

.post img{
  width:100%;
  border-radius:10px;
}

/* FLOAT BUTTON */
.upload-btn{
  position:fixed;
  bottom:70px;
  right:25px;
  width:60px;
  height:60px;
  border-radius:50%;
  background:#1877f2;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  font-size:30px;
  box-shadow:0 4px 10px rgba(0,0,0,0.3);
  z-index:1500;
  cursor:pointer;
}

/* BOTTOM NAV */
.bottom-nav{
  position:fixed;
  bottom:0;
  width:100%;
  height:65px;
  background:white;
  display:flex;
  justify-content:space-around;
  align-items:center;
  box-shadow:0 -2px 5px rgba(0,0,0,0.1);
}

.bottom-nav a{
  text-decoration:none;
  color:#555;
  text-align:center;
  font-size:12px;
}

.bottom-nav .material-icons{
  display:block;
  font-size:28px;
}

.active{color:#0b3d91 !important;}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="top-bar">
  <div class="logo">MingleJoys</div>
  <div class="top-icons">
    <span class="material-icons">notifications</span>
    <span class="material-icons">search</span>
    <span class="material-icons">menu</span>
  </div>
</div>

<!-- STORY BAR -->
<div class="story-bar" id="storyBar"></div>

<!-- STORY VIEWER -->
<div class="story-viewer" id="viewer">
  <div class="progress-bar">
    <div class="progress" id="progress"></div>
  </div>
  <img id="storyImage">
</div>

<!-- CONTENT -->
<div class="content" id="content"></div>

<!-- FLOAT BUTTON -->
<div class="upload-btn" onclick="document.getElementById('fileInput').click()">+</div>
<input type="file" id="fileInput" accept="image/*" style="display:none">

<!-- BOTTOM NAV -->
<div class="bottom-nav">
  <div class="active">
    <span class="material-icons">home</span>
    Home
  </div>
  <a href="reels.html">
    <span class="material-icons">smart_display</span>
    Reels
  </a>
  <a href="gift.html">
    <span class="material-icons">card_giftcard</span>
    Gift
  </a>
  <a href="friend.html">
    <span class="material-icons">group</span>
    Friend
  </a>
  <a href="profile.html">
    <span class="material-icons">person</span>
    Profile
  </a>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

const supabase = createClient("YOUR_SUPABASE_URL","YOUR_SUPABASE_KEY");

/* LOAD STORIES */
async function loadStories(){
  const storyBar = document.getElementById("storyBar");
  storyBar.innerHTML="";

  // CREATE STORY FIRST
  storyBar.innerHTML += `
    <div class="story-box" onclick="window.location.href='upload.story.html'">
      <div class="story-hex seen">
        <img src="https://via.placeholder.com/150">
      </div>
      <div class="story-name">Create</div>
    </div>
  `;

  const { data } = await supabase.from("stories").select("*").order("created_at",{ascending:false});
  const now = new Date().getTime();

  data?.forEach(story=>{
    const storyTime = new Date(story.created_at).getTime();
    const hours = (now - storyTime)/(1000*60*60);

    if(hours<24){
      storyBar.innerHTML += `
        <div class="story-box" onclick="openStory('${story.image_url}', this)">
          <div class="story-hex">
            <img src="${story.image_url}">
          </div>
          <div class="story-name">${story.user_name}</div>
        </div>
      `;
    }
  });
}

loadStories();

/* STORY VIEWER */
let timer;

window.openStory = function(img, el){
  document.getElementById("viewer").style.display="flex";
  document.getElementById("storyImage").src = img;
  const progress = document.getElementById("progress");
  progress.style.width="0%";

  let width=0;
  timer=setInterval(()=>{
    width+=1;
    progress.style.width=width+"%";
    if(width>=100) closeStory();
  },50);

  el.querySelector(".story-hex").classList.add("seen");
}

function closeStory(){
  document.getElementById("viewer").style.display="none";
  clearInterval(timer);
}

document.getElementById("viewer").addEventListener("click", closeStory);

</script>

</body>
</html>
