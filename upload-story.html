<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snapchat Style Story Editor</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; background: #000; color: white; font-family: sans-serif; overflow: hidden; height: 100vh; }

  .editor-container { position: relative; width: 100%; height: 100vh; }
  
  .side-tools {
    position: absolute; right: 15px; top: 80px; z-index: 50;
    display: flex; flex-direction: column; gap: 20px;
  }
  .tool-btn {
    display: flex; align-items: center; gap: 10px; justify-content: flex-end; cursor: pointer;
  }
  .icon-bg {
    width: 45px; height: 45px; background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px); border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    border: 1px solid rgba(255,255,255,0.3);
  }

  /* ইফেক্ট প্যানেল */
  #effect-panel {
    position: absolute; bottom: -200px; width: 100%; height: 180px;
    background: linear-gradient(transparent, rgba(0,0,0,0.9));
    z-index: 100; transition: bottom 0.4s ease;
    display: flex; flex-direction: column; align-items: center;
  }
  #effect-panel.active { bottom: 0; }

  .done-bar { width: 100%; display: flex; justify-content: flex-end; padding-right: 20px; }
  .done-text { font-weight: bold; padding: 10px; cursor: pointer; color: white; font-size: 18px; }

  .effect-scroll {
    display: flex; gap: 15px; overflow-x: auto; width: 100%;
    padding: 10px 20px 30px; scrollbar-width: none;
  }
  .effect-scroll::-webkit-scrollbar { display: none; }

  .effect-circle {
    min-width: 70px; height: 70px; border-radius: 50%;
    border: 3px solid rgba(255,255,255,0.5); overflow: hidden;
    flex-shrink: 0; transition: 0.3s;
  }
  .effect-circle.selected { border-color: #fff; transform: scale(1.1); box-shadow: 0 0 15px #fff; }
  .effect-circle img { width: 100%; height: 100%; object-fit: cover; }

  .footer { position: absolute; bottom: 30px; width: 100%; padding: 0 20px; display: flex; justify-content: space-between; align-items: center; }
  .share-now {
    background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
    color: white; border: none; padding: 12px 30px; border-radius: 50px;
    font-weight: bold; display: flex; align-items: center; gap: 8px;
  }
</style>
</head>
<body>

<div class="editor-container">
  <canvas id="mainCanvas"></canvas>

  <div class="side-tools">
    <div class="tool-btn" onclick="addText()"><small>Text</small><div class="icon-bg"><span class="material-icons">title</span></div></div>
    <div class="tool-btn" onclick="openEffects()"><small>Effects</small><div class="icon-bg"><span class="material-icons">auto_fix_high</span></div></div>
    <div class="tool-btn"><small>Music</small><div class="icon-bg"><span class="material-icons">music_note</span></div></div>
  </div>

  <div id="effect-panel">
    <div class="done-bar"><span class="done-text" onclick="closeEffects()">Done</span></div>
    <div class="effect-scroll" id="effectContainer"></div>
  </div>

  <div class="footer" id="mainFooter">
    <span class="material-icons">settings</span>
    <button class="share-now">Share now <span class="material-icons">send</span></button>
  </div>
</div>

<script>
  const canvas = new fabric.Canvas('mainCanvas', {
    width: window.innerWidth,
    height: window.innerHeight,
    selection: false
  });

  window.onload = () => {
    const data = localStorage.getItem("tempStory");
    if (data) {
      fabric.Image.fromURL(data, (img) => {
        const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
        img.set({ originX: 'center', originY: 'center', left: canvas.width/2, top: canvas.height/2, scaleX: scale, scaleY: scale, selectable: false });
        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
      });
    }
    generateEffects();
  };

  // এখানে আপনার ২০টি ইফেক্টের নাম এবং ইমেজের লিঙ্ক দিন
  const myEffects = [
    { name: "Original", thumb: "https://via.placeholder.com/100?text=Original" },
    { name: "Sad", thumb: "https://via.placeholder.com/100/555/fff?text=Sad" },
    { name: "Happy", thumb: "https://via.placeholder.com/100/f39c12/fff?text=Happy" },
    { name: "Vintage", thumb: "IMG_20260220_033004.jpg/100/e67e22/fff?text=Vintage" },
    { name: "B&W", thumb: "https://via.placeholder.com/100/000/fff?text=B&W" },
    { name: "Night", thumb: "https://via.placeholder.com/100/2c3e50/fff?text=Night" },
    { name: "Retro", thumb: "https://via.placeholder.com/100/8e44ad/fff?text=Retro" },
    // এভাবে ২০ পর্যন্ত ইমেজ লিঙ্ক যোগ করুন...
  ];

  function generateEffects() {
    const container = document.getElementById('effectContainer');
    myEffects.forEach((eff, index) => {
      const div = document.createElement('div');
      div.className = `effect-circle ${index === 0 ? 'selected' : ''}`;
      // এখানে eff.thumb ব্যবহার করে ইমেজটি গোল বাটনের ভেতর বসানো হচ্ছে
      div.innerHTML = `<img src="${eff.thumb}" onclick="applyFilter('${eff.name}', this)">`;
      container.appendChild(div);
    });
  }

  function openEffects() {
    document.getElementById('effect-panel').classList.add('active');
    document.getElementById('mainFooter').style.display = 'none';
  }

  function closeEffects() {
    document.getElementById('effect-panel').classList.remove('active');
    document.getElementById('mainFooter').style.display = 'flex';
  }

  function applyFilter(type, el) {
    document.querySelectorAll('.effect-circle').forEach(c => c.classList.remove('selected'));
    el.parentElement.classList.add('selected');
    
    const img = canvas.backgroundImage;
    if (!img) return;

    img.filters = []; 
    
    if (type === 'Sad') img.filters.push(new fabric.Image.filters.Grayscale());
    if (type === 'Happy') img.filters.push(new fabric.Image.filters.Contrast({ contrast: 0.3 }));
    if (type === 'Vintage') img.filters.push(new fabric.Image.filters.Sepia());
    if (type === 'B&W') img.filters.push(new fabric.Image.filters.BlackWhite());
    if (type === 'Night') img.filters.push(new fabric.Image.filters.Brightness({ brightness: -0.3 }));
    // আপনার অন্য ফিল্টার লজিকগুলো এখানে লিখুন

    img.applyFilters();
    canvas.renderAll();
  }

  function addText() {
    const text = new fabric.IText('টাইপ করুন', { 
        left: canvas.width/2, 
        top: canvas.height/2, 
        fill: '#fff',
        originX: 'center'
    });
    canvas.add(text);
    canvas.setActiveObject(text);
  }
</script>

</body>
</html>
