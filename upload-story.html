<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Story Editor</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  body { margin: 0; background: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }

  .editor-container { position: relative; width: 100%; height: 100vh; }
  
  /* সাইড মেনু */
  .side-tools {
    position: absolute; right: 15px; top: 60px; z-index: 50;
    display: flex; flex-direction: column; gap: 15px;
  }
  .tool-btn { display: flex; align-items: center; gap: 8px; justify-content: flex-end; cursor: pointer; }
  .icon-bg {
    width: 44px; height: 44px; background: rgba(255,255,255,0.15);
    backdrop-filter: blur(15px); border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    border: 1px solid rgba(255,255,255,0.2);
  }

  /* Snapchat Style ইফেক্ট প্যানেল (শেয়ার বাটনের উপরে) */
  #effect-panel {
    position: absolute; 
    bottom: -220px; 
    width: 100%; 
    z-index: 100; 
    transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
  }
  
  #effect-panel.active { bottom: 110px; }

  .done-bar { width: 100%; display: flex; justify-content: center; margin-bottom: 15px; }
  .done-btn { 
    background: #fff; color: #000; padding: 6px 24px; 
    border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 14px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  }

  .effect-scroll {
    display: flex; gap: 12px; overflow-x: auto; width: 100%;
    padding: 0 20px 10px; scrollbar-width: none;
  }
  .effect-scroll::-webkit-scrollbar { display: none; }

  .effect-item-wrapper { display: flex; flex-direction: column; align-items: center; gap: 5px; }

  .effect-circle {
    min-width: 72px; height: 72px; border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.4); overflow: hidden;
    flex-shrink: 0; transition: 0.3s; background: #111;
  }
  .effect-circle.selected { 
    border-color: #fff; border-width: 3px; transform: scale(1.1); 
    box-shadow: 0 0 15px rgba(255,255,255,0.3); 
  }
  .effect-circle img { width: 100%; height: 100%; object-fit: cover; }
  .eff-name { font-size: 10px; color: #ccc; }

  /* ফুটার সেকশন */
  .footer { 
    position: absolute; bottom: 30px; width: 100%; 
    padding: 0 20px; display: flex; justify-content: space-between; 
    align-items: center; z-index: 50;
  }
  .share-now {
    background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
    color: white; border: none; padding: 12px 28px; border-radius: 50px;
    font-weight: bold; display: flex; align-items: center; gap: 8px; font-size: 15px;
  }
</style>
</head>
<body>

<div class="editor-container">
  <canvas id="mainCanvas"></canvas>

  <div class="side-tools">
    <div class="tool-btn" onclick="addText()"><small>Text</small><div class="icon-bg"><span class="material-icons">title</span></div></div>
    <div class="tool-btn" onclick="openEffects()"><small>Effects</small><div class="icon-bg"><span class="material-icons">auto_fix_high</span></div></div>
    <div class="tool-btn"><small>Music</small><div class="icon-bg"><span class="material-icons">music_note</span></div></div>
  </div>

  <div id="effect-panel">
    <div class="done-bar"><div class="done-btn" onclick="closeEffects()">Done</div></div>
    <div class="effect-scroll" id="effectContainer"></div>
  </div>

  <div class="footer" id="mainFooter">
    <div class="icon-bg"><span class="material-icons">settings</span></div>
    <button class="share-now">Share now <span class="material-icons">send</span></button>
  </div>
</div>

<script>
  const canvas = new fabric.Canvas('mainCanvas', {
    width: window.innerWidth,
    height: window.innerHeight,
    selection: false
  });

  window.onload = () => {
    const data = localStorage.getItem("tempStory");
    if (data) {
      fabric.Image.fromURL(data, (img) => {
        const scale = Math.max(canvas.width / img.width, canvas.height / img.height);
        img.set({ originX: 'center', originY: 'center', left: canvas.width/2, top: canvas.height/2, scaleX: scale, scaleY: scale, selectable: false });
        canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
      });
    }
    generateEffects();
  };

  // --- GitHub ইমেজের লিঙ্ক এখানে বসাবেন ---
  const myEffects = [
    { name: "Original", thumb: "https://via.placeholder.com/100?text=Org" },
    { name: "Sad", thumb: "আপনার_লিঙ্ক_১" },
    { name: "Happy", thumb: "1771540274072.png" },
    { name: "Vintage", thumb: "IMG_20260220_033004.jpg" },
    { name: "B&W", thumb: "আপনার_লিঙ্ক_৪" },
    { name: "Night", thumb: "1771539431195.png" },
    { name: "Gold", thumb: "1771539675249.png" },
    { name: "Neon", thumb: "আপনার_লিঙ্ক_৭" },
    { name: "Retro", thumb: "আপনার_লিঙ্ক_৮" },
    { name: "Soft", thumb: "আপনার_লিঙ্ক_৯" },
    { name: "Cool", thumb: "আপনার_লিঙ্ক_১০" },
    { name: "Warm", thumb: "আপনার_লিঙ্ক_১১" },
    { name: "Dreamy", thumb: "আপনার_লিঙ্ক_১২" },
    { name: "Fade", thumb: "আপনার_লিঙ্ক_১৩" },
    { name: "Bold", thumb: "আপনার_লিঙ্ক_১৪" },
    { name: "Mist", thumb: "আপনার_লিঙ্ক_১৫" },
    { name: "Ocean", thumb: "আপনার_লিঙ্ক_১৬" },
    { name: "Forest", thumb: "আপনার_লিঙ্ক_১৭" },
    { name: "Sunset", thumb: "আপনার_লিঙ্ক_১৮" },
    { name: "Cyber", thumb: "আপনার_লিঙ্ক_১৯" },
    { name: "Glitch", thumb: "আপনার_লিঙ্ক_২০" }
  ];

  function generateEffects() {
    const container = document.getElementById('effectContainer');
    myEffects.forEach((eff, index) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'effect-item-wrapper';
      
      const div = document.createElement('div');
      div.className = `effect-circle ${index === 0 ? 'selected' : ''}`;
      div.innerHTML = `<img src="${eff.thumb}" onclick="applyFilter('${eff.name}', this)">`;
      
      const label = document.createElement('div');
      label.className = 'eff-name';
      label.innerText = eff.name;

      wrapper.appendChild(div);
      wrapper.appendChild(label);
      container.appendChild(wrapper);
    });
  }

  function openEffects() {
    document.getElementById('effect-panel').classList.add('active');
    document.getElementById('mainFooter').style.opacity = "0.3";
    document.getElementById('mainFooter').style.pointerEvents = "none";
  }

  function closeEffects() {
    document.getElementById('effect-panel').classList.remove('active');
    document.getElementById('mainFooter').style.opacity = "1";
    document.getElementById('mainFooter').style.pointerEvents = "auto";
  }

  function applyFilter(type, el) {
    document.querySelectorAll('.effect-circle').forEach(c => c.classList.remove('selected'));
    el.parentElement.classList.add('selected');
    
    const img = canvas.backgroundImage;
    if (!img) return;

    img.filters = []; 
    // স্যাম্পল ফিল্টার লজিক (আপনার চাহিদা মতো ২০টি আলাদা লজিক দেওয়া যাবে)
    if (type === 'Sad') img.filters.push(new fabric.Image.filters.Grayscale());
    if (type === 'Vintage') img.filters.push(new fabric.Image.filters.Sepia());
    if (type === 'B&W') img.filters.push(new fabric.Image.filters.BlackWhite());
    if (type === 'Night') img.filters.push(new fabric.Image.filters.Brightness({ brightness: -0.2 }));
    if (type === 'Gold') img.filters.push(new fabric.Image.filters.ColorMatrix({ matrix: [1, 0, 0, 0, 0.1, 0, 1, 0, 0, 0, 0, 0, 0.8, 0, 0, 0, 0, 0, 1, 0] }));

    img.applyFilters();
    canvas.renderAll();
  }

  function addText() {
    const text = new fabric.IText('টাইপ করুন', { 
        left: canvas.width/2, top: canvas.height/2, 
        fill: '#fff', originX: 'center', fontFamily: 'sans-serif' 
    });
    canvas.add(text);
    canvas.setActiveObject(text);
  }
</script>

</body>
</html>
