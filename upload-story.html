<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Story Editor</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{margin:0;background:#000;color:#fff;font-family:'Segoe UI',sans-serif;overflow:hidden;height:100vh;}
.editor-container{position:relative;width:100%;height:100vh;}

canvas{position:absolute;top:0;left:0;}

/* CLOSE BUTTON */
.close-btn{
position:absolute;
top:20px;
left:15px;
z-index:200;
}

.icon-bg{
width:44px;height:44px;background:rgba(255,255,255,0.15);
backdrop-filter:blur(15px);border-radius:50%;
display:flex;justify-content:center;align-items:center;
border:1px solid rgba(255,255,255,0.2);
cursor:pointer;
}

/* RIGHT TOOLS */
.side-tools{
position:absolute;
right:15px;
top:120px;
z-index:100;
display:flex;
flex-direction:column;
gap:25px;
}

.tool-btn{
display:flex;
flex-direction:column;
align-items:center;
gap:6px;
cursor:pointer;
font-size:11px;
color:#ccc;
}

/* SHARE BUTTON */
.footer{
position:absolute;
bottom:70px;
width:100%;
display:flex;
justify-content:center;
z-index:100;
}

.share-now{
background:linear-gradient(45deg,#f09433,#e6683c,#dc2743,#cc2366,#bc1888);
color:white;border:none;padding:12px 28px;border-radius:50px;
font-weight:bold;display:flex;align-items:center;gap:8px;font-size:15px;
}

/* CONFIRM POPUP */
#confirm-popup{
position:absolute;
top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.6);
backdrop-filter:blur(6px);
display:flex;justify-content:center;align-items:center;
z-index:500;
opacity:0;pointer-events:none;transition:.3s;
}
#confirm-popup.active{opacity:1;pointer-events:auto;}

.popup-box{
background:#1c1c1c;
padding:25px;border-radius:15px;
width:85%;max-width:320px;text-align:center;
}

.popup-buttons{
margin-top:20px;display:flex;gap:10px;
}

.popup-buttons button{
flex:1;padding:10px;border-radius:8px;
border:none;font-weight:bold;cursor:pointer;
}

.keep-btn{background:#333;color:#fff;}
.discard-btn{background:#ff3b30;color:#fff;}

/* EFFECT PANEL */
#effect-panel{
position:absolute;bottom:-250px;width:100%;z-index:200;
transition:.4s;
}
#effect-panel.active{bottom:110px;}

.done-bar{display:flex;justify-content:center;margin-bottom:15px;}

.done-btn{
background:#fff;color:#000;padding:6px 24px;
border-radius:20px;font-weight:bold;cursor:pointer;font-size:14px;
}

.effect-scroll{
display:flex;gap:12px;overflow-x:auto;padding:0 20px 10px;
}
.effect-scroll::-webkit-scrollbar{display:none;}

.effect-circle{
min-width:72px;height:72px;border-radius:50%;
border:2px solid rgba(255,255,255,0.4);
overflow:hidden;transition:.3s;background:#111;
}

.effect-circle.selected{
border-color:#fff;border-width:3px;transform:scale(1.1);
}
</style>
</head>

<body>

<div class="editor-container">

<canvas id="mainCanvas"></canvas>

<div class="close-btn">
<div class="icon-bg" onclick="openConfirm()">
<span class="material-icons">close</span>
</div>
</div>

<div class="side-tools">

<div class="tool-btn" onclick="addText()">
<div class="icon-bg"><span class="material-icons">title</span></div>
<small>Text</small>
</div>

<div class="tool-btn" onclick="openEffects()">
<div class="icon-bg"><span class="material-icons">auto_fix_high</span></div>
<small>Effect</small>
</div>

<div class="tool-btn">
<div class="icon-bg"><span class="material-icons">settings</span></div>
<small>Setting</small>
</div>

</div>

<div class="footer">
<button class="share-now">Share now <span class="material-icons">send</span></button>
</div>

<div id="confirm-popup">
<div class="popup-box">
<h3>Discard changes?</h3>
<div class="popup-buttons">
<button class="keep-btn" onclick="closeConfirm()">Keep Editing</button>
<button class="discard-btn" onclick="discardStory()">Discard</button>
</div>
</div>
</div>

<div id="effect-panel">
<div class="done-bar">
<div class="done-btn" onclick="closeEffects()">Done</div>
</div>
<div class="effect-scroll" id="effectContainer"></div>
</div>

</div>

<script>

const canvas = new fabric.Canvas('mainCanvas',{
width:window.innerWidth,
height:window.innerHeight,
selection:false
});

/* LOAD IMAGE FROM HOME */
const savedImage = localStorage.getItem("storyImage");

if(savedImage){
fabric.Image.fromURL(savedImage, function(img){

img.scaleToWidth(canvas.width);
img.scaleToHeight(canvas.height);

img.set({
left: canvas.width/2,
top: canvas.height/2,
originX: "center",
originY: "center"
});

canvas.add(img);
canvas.sendToBack(img);
canvas.renderAll();

});
}

/* TEXT */
function addText(){
const text=new fabric.IText("টাইপ করুন",{
left:canvas.width/2,
top:canvas.height/2,
fill:"#fff",
originX:"center"
});
canvas.add(text);
canvas.setActiveObject(text);
}

/* EFFECTS */
const effects=[
"Original","B&W","Vintage","Warm","Cool","Neon","Sad","Night","Gold","Retro",
"Soft","Bold","Dreamy","Fade","Mist","Ocean","Forest","Sunset","Cyber","Glitch"
];

function generateEffects(){
const container=document.getElementById("effectContainer");
effects.forEach(name=>{
const circle=document.createElement("div");
circle.className="effect-circle";
circle.onclick=()=>applyFilter(name,circle);
container.appendChild(circle);
});
}

function applyFilter(type,el){
document.querySelectorAll('.effect-circle').forEach(c=>c.classList.remove('selected'));
el.classList.add('selected');

canvas.getObjects().forEach(obj=>{
if(obj.type==='image'){
obj.filters=[];

switch(type){
case "B&W": obj.filters.push(new fabric.Image.filters.Grayscale()); break;
case "Vintage": obj.filters.push(new fabric.Image.filters.Sepia()); break;
case "Warm": obj.filters.push(new fabric.Image.filters.Brightness({brightness:0.1})); break;
case "Cool": obj.filters.push(new fabric.Image.filters.Contrast({contrast:0.3})); break;
case "Neon": obj.filters.push(new fabric.Image.filters.Invert()); break;
case "Sad": obj.filters.push(new fabric.Image.filters.Saturation({saturation:-0.5})); break;
case "Night": obj.filters.push(new fabric.Image.filters.Brightness({brightness:-0.4})); break;
case "Gold": obj.filters.push(new fabric.Image.filters.BlendColor({color:"#FFD700",mode:"overlay",alpha:0.4})); break;
case "Retro": obj.filters.push(new fabric.Image.filters.Brownie()); break;
case "Soft": obj.filters.push(new fabric.Image.filters.Blur({blur:0.05})); break;
case "Bold": obj.filters.push(new fabric.Image.filters.Contrast({contrast:0.6})); break;
case "Dreamy": obj.filters.push(new fabric.Image.filters.Blur({blur:0.08})); break;
case "Fade": obj.filters.push(new fabric.Image.filters.Contrast({contrast:-0.2})); break;
case "Mist": obj.filters.push(new fabric.Image.filters.BlendColor({color:"#fff",mode:"overlay",alpha:0.3})); break;
case "Ocean": obj.filters.push(new fabric.Image.filters.BlendColor({color:"#0077be",mode:"overlay",alpha:0.4})); break;
case "Forest": obj.filters.push(new fabric.Image.filters.BlendColor({color:"#228b22",mode:"overlay",alpha:0.3})); break;
case "Sunset": obj.filters.push(new fabric.Image.filters.BlendColor({color:"#ff4500",mode:"overlay",alpha:0.4})); break;
case "Cyber": obj.filters.push(new fabric.Image.filters.HueRotation({rotation:0.5})); break;
case "Glitch": obj.filters.push(new fabric.Image.filters.Invert()); break;
}

obj.applyFilters();
}
});
canvas.renderAll();
}

/* PANELS */
function openEffects(){
document.getElementById("effect-panel").classList.add("active");
}
function closeEffects(){
document.getElementById("effect-panel").classList.remove("active");
}

/* CONFIRM */
function openConfirm(){
document.getElementById("confirm-popup").classList.add("active");
}
function closeConfirm(){
document.getElementById("confirm-popup").classList.remove("active");
}
function discardStory(){
window.location.href="home.html";
}

generateEffects();

</script>

</body>
</html>
