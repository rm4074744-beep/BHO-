<!DOCTYPE html>
<html>
<head>
<title>Marketplace - From Ajj</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background:#f1f3f6;
}

/* Header */
.header{
  background:#2874f0;
  padding:10px 20px;
  display:flex;
  align-items:center;
  gap:20px;
}

.header img{
  height:40px;
  border-radius:50%;
}

.search-box{
  flex:1;
  display:flex;
}

.search-box input{
  width:100%;
  padding:10px;
  border:none;
  outline:none;
  border-radius:4px 0 0 4px;
}

.search-box button{
  padding:10px 15px;
  border:none;
  background:#ff9f00;
  cursor:pointer;
  border-radius:0 4px 4px 0;
}

/* Upload Section */
.upload-section{
  padding:15px;
  background:white;
  margin:15px;
  border-radius:8px;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

.upload-section input{
  margin:5px 0;
  padding:8px;
  width:100%;
}

/* Product Grid */
.products{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:15px;
  padding:15px;
}

.card{
  background:white;
  border-radius:8px;
  overflow:hidden;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  transition:0.3s;
}

.card:hover{
  transform:scale(1.03);
}

.card img{
  width:100%;
  height:150px;
  object-fit:cover;
}

.card-body{
  padding:10px;
}

.price{
  color:green;
  font-weight:bold;
}

</style>
</head>
<body>

<!-- Header -->
<div class="header">
  <img src="1770938375308.png" alt="Logo">
  <div class="search-box">
    <input type="text" id="search" placeholder="Search products...">
    <button onclick="searchProduct()">üîç</button>
  </div>
</div>

<!-- Upload Product -->
<div class="upload-section">
  <h3>Add Product</h3>
  <input type="text" id="pname" placeholder="Product Name"><br>
  <input type="text" id="pprice" placeholder="Price"><br>
  <input type="file" id="pimage"><br><br>
  <button onclick="addProduct()">Add Product</button>
</div>

<!-- Products -->
<div class="products" id="productList"></div>

<!-- ================= Script Section ================= -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, onValue } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyA1h3IIRC9la-kXyYnVEfwxzzoyBIL70Js",
  authDomain: "my-website-a0545.firebaseapp.com",
  databaseURL: "https://my-website-a0545-default-rtdb.firebaseio.com",
  projectId: "my-website-a0545",
  storageBucket: "my-website-a0545.firebasestorage.app",
  messagingSenderId: "103602694974",
  appId: "1:103602694974:web:12f890844e6ad6a513da6f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const productRef = ref(db, "products");

// Load products realtime
onValue(productRef, (snapshot) => {
  const data = snapshot.val();
  const list = document.getElementById("productList");
  list.innerHTML = "";

  if(data){
    Object.values(data).reverse().forEach(product => {
      list.innerHTML += `
        <div class="card">
          <img src="${product.image}">
          <div class="card-body">
            <div>${product.name}</div>
            <div class="price">‚Çπ ${product.price}</div>
          </div>
        </div>
      `;
    });
  }
});

// Add Product
window.addProduct = async function() {

  const name = document.getElementById("pname").value;
  const price = document.getElementById("pprice").value;
  const file = document.getElementById("pimage").files[0];

  if(!file){
    alert("Select Image");
    return;
  }

  const formData = new FormData();
  formData.append("file", file);
  formData.append("upload_preset", "Mingle"); // Cloudinary preset

  const response = await fetch(
    "https://api.cloudinary.com/v1_1/dxksdswlu/image/upload",
    { method: "POST", body: formData }
  );

  const data = await response.json();
  const imageURL = data.secure_url;

  push(productRef, {
    name: name,
    price: price,
    image: imageURL
  });

  alert("Product Added Successfully üî•");
};

// Search Function
function searchProduct(){
  const keyword = document.getElementById("search").value.toLowerCase();
  onValue(productRef, (snapshot) => {
    const data = snapshot.val();
    const list = document.getElementById("productList");
    list.innerHTML = "";
    if(data){
      Object.values(data).reverse().forEach(product => {
        if(product.name.toLowerCase().includes(keyword)){
          list.innerHTML += `
            <div class="card">
              <img src="${product.image}">
              <div class="card-body">
                <div>${product.name}</div>
                <div class="price">‚Çπ ${product.price}</div>
              </div>
            </div>
          `;
        }
      });
    }
  });
}

</script>

</body>
</html>
